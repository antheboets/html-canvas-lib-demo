(()=>{"use strict";const t=class{constructor(){this.timeoutFunc=null,this.timeoutNumber=0}GetTimeoutTime(){if(null!==this.timeoutFunc){const t=this.timeoutFunc();if(Number.isInteger(t))return t}return Number.isInteger(this.timeoutNumber)&&0!==this.timeoutNumber?this.timeoutNumber:2978}start(){}stop(){}draw(t){}};function e(t=""){if(null==t)return"none";if("string"!=typeof t)return"none";switch(t.split(".").pop().toLowerCase()){case"mp4":case"webm":return"video";case"mp3":return"audio";case"png":case"jpg":return"image";default:return"none"}}function i(t,e){return{...t,...e}}function n(t="100%"){if(null==t)return 1;if("string"!=typeof t)return 1;if("%"!==t.slice(-1))return 1;let e=Number(t.slice(0,t.length-1));return isNaN(e)?1:e/100}function s(t){return null!=t&&("string"==typeof t&&("%"===t.slice(-1)&&NaN!==Number(t.slice(0,t.length-1))))}const a=class{#t;#e;#i;#n;constructor(t=0,e={}){this.#i=e,this.setCoordinate=t}set setCoordinate(t){if(this.#t=t,s(t))return this.#n=!0,void(this.#e=n(this.#t)*this.#i());this.#e=t,this.#n=!1}get getCoordinate(){return Math.round(this.#e)}get getCoordinateValue(){return this.#t}get isPercent(){return this.#n}updateAxis(t){this.#n&&(this.#e=n(this.#t)*t)}},o=class{#s;#i;#a;#o;#r;#h;constructor(t=0,e="manual",i={}){this.#o=0,this.#i=i,this.setMode=e,this.setSize=t}get getMode(){return this.#a}set setMode(t){switch(t){case"manual":default:this.#a="manual";break;case"canvasSize":this.#a="canvasSize",this.setSize=this.#i();break;case"native":this.#a="native",this.setSize=this.#o}}set setNativeSize(t){this.#o=t,"native"===this.#a&&(this.setSize=this.#h)}get getNativeSize(){return this.#o}set setSize(t){switch(this.#h=t,this.#a){case"manual":if(s(t)){this.#r=n(t)*this.#o,this.#s=!0;break}this.#r=t,this.#s=!1;break;case"canvasSize":if(this.#s=!0,s(t)){this.#r=n(t)*this.#i();break}this.#r=this.#i();break;case"native":if(s(t)){this.#r=n(t)*this.#o,this.#s=!0;break}this.#r=this.#o,this.#s=!1}}get getSize(){return Math.round(this.#r)}get getSizeValue(){return this.#h}get getSizeMode(){return this.#a}get isPercent(){return this.#s}updateSize(t){s(this.#h)?this.#r=n(this.#h)*t:this.#r=t}},r=class extends t{constructor(t,e){super(),this.x=new a(t.x,(()=>g().canvasElement.width)),this.y=new a(t.y,(()=>g().canvasElement.height)),this.height=new o(t.height,t.heightMode,(()=>g().canvasElement.height)),this.width=new o(t.width,t.widthMode,(()=>g().canvasElement.width)),this.loadedPromise=new Promise(e)}set setHeight(t){this.height.setSize=t}get getHeight(){return this.height.getSize}set setWidth(t){this.width.setSize=t}get getWidth(){return this.width.getSize}set setHeightMode(t){this.height.setMode=t}get getHeightMode(){return this.height.getMode}set setWidthMode(t){this.width.setMode=t}get getWidthMode(){return this.width.getMode}get getNativeHeight(){return this.height.getNativeSize}get getNativeWidth(){return this.width.getNativeSize}set setXPos(t){this.x.setCoordinate(t)}get getXPos(){return this.x.getCoordinate}set setYPos(t){this.y.setCoordinate(t)}get getYPos(){return this.y.getCoordinate}},h=class extends r{constructor(t){const e=new Image;super(t,((t,i)=>{e.onload=()=>{this.width.setNativeSize=e.width,this.height.setNativeSize=e.height,t()}})),this.image=e,this.image.src=t.path}draw(t){t.drawImage(this.image,this.getXPos,this.getYPos,this.getWidth,this.getHeight)}},c=class extends r{constructor(t){const e=document.createElement("video");e.muted=!0,e.autoplay=!0,e.loop=!0,super(t,((t,i)=>{e.oncanplay=()=>{this.height.setNativeSize=e.height,this.width.setNativeSize=e.width,t()}})),e.src=t.path,this.videoContainer={video:e,ready:!1,scale:1/0}}draw(t){void 0!==this.videoContainer&&this.videoContainer.ready&&t.drawImage(this.videoContainer.video,this.getXPos,this.getYPos,this.getWidth,this.getHeight)}start(){this.videoContainer.ready=!0,this.videoContainer.video.play()}stop(){this.videoContainer.pause(),this.videoContainer.currentTime=0}};function d(t="",e=""){return`${t}: ${e}`}function u(){if(g().startAnimationtest){if(g().now=Date.now(),g().elapsed=g().now-g().then,g().elapsedFrameCount++,g().elapsed>g().fpsInterval&&(g().then=g().now-g().elapsed%g().fpsInterval,g().ctx.clearRect(0,0,g().canvasElement.width,g().canvasElement.height),g().layers.forEach((t=>{t.currentContent.draw(g().ctx,g().canvasElement.width,g().canvasElement.height)})),g().drawFps)){let t=g().now-g().startTime,e=Math.round(1e3/(t/++g().frameCount)*100)/100;g().ctx.font="16px Arial",g().ctx.strokeStyle="grey",g().ctx.fillStyle="rgba(190,190,190,0.8)",g().ctx.fillRect(10,10,200,130),g().ctx.strokeStyle="black",g().ctx.fillStyle="black",g().ctx.fillText(d("Fps",function(t=0,e=0,i=" "){let n="";for(let s=0;s+t.toString().length<e.toString().length;s++)n+=i;return`${n}${t}/${e}fps`}(e,g().fps)),20,30),g().ctx.fillText(d("Start time",t/1e3+"sec"),20,50),g().ctx.fillText(d("Drawn frame count",`${g().frameCount}`),20,70),g().ctx.fillText(d("Total frame count",`${g().elapsedFrameCount}`),20,90),g().ctx.fillText(d("Elapsed",`${g().elapsed}`),20,110),g().ctx.fillText(d("Then",`${g().then}`),20,130)}window.requestAnimationFrame(u)}}let l=null;function m(){return null===l&&(l=new class{constructor(){this.layers=[],this.now=0,this.fps=60,this.fpsInterval=1e3/this.fps,this.then=0,this.elapsed=0,this.drawFps=!1,this.frameCount=0,this.elapsedFrameCount=0,this.startAnimationtest=!1,this.canvasElement=document.createElement("canvas"),this.canvasElement.width=window.innerWidth,this.canvasElement.height=window.innerHeight,this.ctx=this.canvasElement.getContext("2d"),document.body.appendChild(this.canvasElement),window.addEventListener("resize",(()=>{this.canvasElement.height=window.innerHeight,this.canvasElement.width=window.innerWidth,this.#c()}))}async#d(){const t=this.layers.map((t=>Promise.all(t.getOnloadPromisesArray())));await Promise.all(t)}getLayer(t){return null==t||"number"!=typeof t||this.layers.length<=t?null:this.layers[t]}getLayers(){return this.layers.map((t=>t.getLayer()))}#u(t){this.layers.push(t)}createLayer(t=null){const e=new class{#l;#m;constructor(t="manual"){this.content=[],this.currentPos=0,this.currentContent=null,this.setMode=t,this.#m=null,this.timerActive=!1,this.loopThroughContent=!0}set setMode(t){this.#l="timer"===t?"timer":"manual"}get getMode(){return this.#l}next(){this.#g(!0)}previous(){this.#g(!1)}#p(t){null!==this.currentContent&&("timer"===this.#l&&this.#y(),this.currentContent.stop()),this.currentContent=t,"timer"===this.#l&&this.#v(),this.currentContent.start()}setContentPos(t=0){null!=t&&"number"==typeof t&&(t>=this.content.length||(this.currentPos=t,this.#p(this.content[this.currentPos])))}#g(t=!0){t?this.currentPos<this.content.length-1?(this.currentPos++,this.#p(this.content[this.currentPos])):this.loopThroughContent&&(this.currentPos=0,this.#p(this.content[0])):this.currentPos>0?(this.currentPos--,this.#p(this.content[this.currentPos])):this.loopThroughContent&&(this.currentPos=this.content.length-1,this.#p(this.content[0]))}getOnloadPromisesArray(){return this.content.map((t=>t.getOnloadPromisesArray))}getLayer(){return this.content}removeContent(t){}#w(){1===this.content.length&&this.#p(this.content[0]),null===this.currentContent&&this.#p(this.content[0])}start(){this.#w(),"timer"===this.#l&&this.#v(),this.currentContent.start()}#v(){if(!this.timerActive){const t=()=>{this.#g(),this.#m=window.setTimeout(t,this.currentContent.GetTimeoutTime())};this.#m=window.setTimeout(t,this.currentContent.GetTimeoutTime()),this.timerActive=!0}}#y(){null!==this.#m&&(clearTimeout(this.#m),this.timerActive=!1)}stop(){"timer"===this.#l&&this.#y(),this.currentContent.stop()}addContentFormObj(t){switch(t.contentType){case"image":this.#f(t);break;case"video":this.#z(t)}}#f(t){const e=new h(t);Number.isInteger(t.time)&&(e.timeoutNumber=t.time),t.time instanceof Function&&(e.timeoutFunc=t.time),this.content.push(e)}#z(t){const e=new c(t);Number.isInteger(t.time)&&(e.timeoutNumber=t.time),t.time instanceof Function&&(e.timeoutFunc=t.time),this.content.push(e)}};let i=!0,n=!1;void 0===t&&(i=!1),null===t&&i&&(i=!1),(Array.isArray(t)&&"object"==typeof t||"object"==typeof t||"string"==typeof t)&&(n=!0),i&&n&&this.#C(e,t),this.#u(e)}#C(t,n){if(Array.isArray(n)&&"object"==typeof n&&0!==n.length&&n.forEach((n=>{"object"==typeof n?(n.contentType=e(n.path),t.addContentFormObj(i({contentType:"",path:"",x:0,y:0,height:0,heightMode:"canvasSize",width:0,widthMode:"canvasSize",time:0},n))):("string"==typeof n||n instanceof String)&&t.addContentFormObj(i({contentType:"",path:"",x:0,y:0,height:0,heightMode:"canvasSize",width:0,widthMode:"canvasSize",time:0},{path:n,contentType:e(n)}))})),"object"==typeof n){let s;s=void 0!==n.contentType?n.contentType:e(n.path),t.addContentFormObj(i({contentType:"",path:"",x:0,y:0,height:0,heightMode:"canvasSize",width:0,widthMode:"canvasSize",time:0},{path:n.path,contentType:s,timer:n.timer}))}("string"==typeof n||n instanceof String)&&t.addContentFormObj(i({contentType:"",path:"",x:0,y:0,height:0,heightMode:"canvasSize",width:0,widthMode:"canvasSize",time:0},{path:n,contentType:e(n)}))}removeLayerContent(t,e){this.layers[t].removeLayerContent(e)}stop(){this.startAnimationtest=!1,this.layers.forEach((t=>{t.stop()}))}async startAsync(){await this.#d(),this.layers.forEach((t=>{t.start()})),this.then=Date.now(),this.frameCount=0,this.elapsedFrameCount=0,this.startTime=this.then,this.startAnimationtest=!0,u()}#c(){this.layers.forEach((t=>{t.content.forEach((t=>{t.height.isPercent&&t.height.updateSize(this.canvasElement.height),t.width.isPercent&&t.width.updateSize(this.canvasElement.width),t.x.isPercent&&t.x.updateAxis(this.canvasElement.width),t.y.isPercent&&t.y.updateAxis(this.canvasElement.height)}))}))}}),l}const g=m,p=new Date;function y(t,e=""){console.log(t,`${e}${(new Date-p)/1e3+" Sec"}`)}console.log("Welcome to the demo"),console.log("Web design is my passion"),console.log("The module source code:"),console.log("https://github.com/antheboets/canvas-lib"),console.log("The demo source code:"),console.log("https://github.com/antheboets/html-canvas-lib-demo"),window.addEventListener("load",(async()=>{y("dom loaded");const t=m();y("canvas created"),t.createLayer("./../content/YouCantWinIfYouDontPlay.webm"),y("added background video"),t.createLayer([{contentType:"image",path:"./../content/backgroundLayer1.png",time:1e3},{contentType:"image",path:"./../content/backgroundLayer2.png",time:2e3},{contentType:"image",path:"./../content/backgroundLayer3.png",time:3e3}]),t.getLayer(1).setMode="timer",y("added the first layer");const e=()=>1e3*function(t=0,e=100){return Math.floor(Math.random()*(e-t)+t)}(1,4);t.createLayer([{contentType:"image",path:"./../content/random1.png",time:()=>{let i=e();return t.getLayer(3).setContentPos(9-i/1e3),i}},{contentType:"image",path:"./../content/random2.png",time:()=>{let i=e();return t.getLayer(3).setContentPos(9-i/1e3),i}}]),t.getLayer(2).setMode="timer",y("added the second layer");let i=[];for(let t=9;t>=0;t--)i.push({contentType:"image",path:`./../content/number${t}.png`,time:1e3,x:"75%",y:"75%",widthMode:"canvasSize",width:"20%",heightMode:"canvasSize",height:"20%"});y(i,"list of numbers "),t.createLayer(i),t.getLayer(3).setMode="timer",y("added the third layer"),await t.startAsync(),y("canvas started"),y(t.getLayer(3).content,"list of numbers "),console.log(t,"done"),window.addEventListener("mousedown",(async e=>{e.preventDefault,y(t.getLayer(3).content)}))}))})();